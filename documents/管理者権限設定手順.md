# ç®¡ç†è€…æ¨©é™è¨­å®šæ‰‹é †

ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®æ‰‹é †ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

## ç›®æ¬¡

1. [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
2. [æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†è€…ã«ã™ã‚‹æ–¹æ³•](#æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†è€…ã«ã™ã‚‹æ–¹æ³•)
3. [ç®¡ç†è€…æ¨©é™ã®ç¢ºèª](#ç®¡ç†è€…æ¨©é™ã®ç¢ºèª)
4. [ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•](#ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•)
5. [ç®¡ç†è€…æ¨©é™ã®å‰¥å¥ª](#ç®¡ç†è€…æ¨©é™ã®å‰¥å¥ª)
6. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## å‰ææ¡ä»¶

- Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¨­å®šæ¸ˆã¿
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨
- å°‘ãªãã¨ã‚‚1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µã‚¤ãƒˆã§ç™»éŒ²æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨

---

## æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†è€…ã«ã™ã‚‹æ–¹æ³•

### æ–¹æ³•1: SQLã§æ¨©é™ã‚’ä»˜ä¸ï¼ˆæ¨å¥¨ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’ç¢ºèª

Supabase SQL Editorã§ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œï¼š

```sql
-- ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’ç¢ºèª
SELECT 
  au.id,
  au.email,
  au.email_confirmed_at,
  up.role,
  up.display_name,
  up.created_at
FROM auth.users au
LEFT JOIN public.user_profiles up ON au.id = up.user_id
ORDER BY au.created_at DESC;
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸

```sql
-- æ–¹æ³•A: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æŒ‡å®š
UPDATE public.user_profiles
SET role = 'admin', updated_at = now()
WHERE user_id IN (
  SELECT id FROM auth.users WHERE email = 'your-email@example.com'
);

-- æ–¹æ³•B: æœ€æ–°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†è€…ã«ã™ã‚‹
UPDATE public.user_profiles
SET role = 'admin', updated_at = now()
WHERE user_id IN (
  SELECT id FROM auth.users ORDER BY created_at DESC LIMIT 1
);
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ç¢ºèª

```sql
-- ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§ã‚’ç¢ºèª
SELECT 
  au.id,
  au.email,
  au.email_confirmed_at,
  up.role,
  up.display_name
FROM auth.users au
LEFT JOIN public.user_profiles up ON au.id = up.user_id
WHERE up.role = 'admin';
```

---

## ç®¡ç†è€…æ¨©é™ã®ç¢ºèª

### æ–¹æ³•1: SQLã§ç¢ºèª

```sql
-- ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†è€…ã‹ã©ã†ã‹ã‚’ç¢ºèª
SELECT 
  up.user_id,
  up.display_name,
  up.role,
  au.email
FROM public.user_profiles up
LEFT JOIN auth.users au ON up.user_id = au.id
WHERE au.email = 'your-email@example.com';
```

### æ–¹æ³•2: ã‚µã‚¤ãƒˆã§ç¢ºèª

1. è©²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
2. å³ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€ŒğŸ›¡ï¸ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã®ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€ç®¡ç†è€…æ¨©é™ã‚ã‚Š
4. `/admin` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ã€ç®¡ç†è€…æ¨©é™ã‚ã‚Š

---

## ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã¾ãšãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—2: ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³

1. `http://localhost:3000/auth/login` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. ãƒ­ã‚°ã‚¤ãƒ³

### ã‚¹ãƒ†ãƒƒãƒ—3: ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹

- æ–¹æ³•A: ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ â†’ ã€ŒğŸ›¡ï¸ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€
- æ–¹æ³•B: ç›´æ¥URL `http://localhost:3000/admin` ã«ã‚¢ã‚¯ã‚»ã‚¹

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ç¢ºèª

ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸï¼š
- ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- å…¬é–‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ•°
- ç·æ³¨æ–‡æ•°
- ç·å£²ä¸Š
- BANæ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
- ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°

---

## ç®¡ç†è€…æ¨©é™ã®å‰¥å¥ª

ç®¡ç†è€…æ¨©é™ã‚’å‰¥å¥ªï¼ˆä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æˆ»ã™ï¼‰ã™ã‚‹å ´åˆï¼š

```sql
-- ç®¡ç†è€…æ¨©é™ã‚’ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æˆ»ã™
UPDATE public.user_profiles
SET role = 'user', updated_at = now()
WHERE user_id IN (
  SELECT id FROM auth.users WHERE email = 'admin-email@example.com'
);

-- ç¢ºèª
SELECT 
  au.email,
  up.role
FROM auth.users au
LEFT JOIN public.user_profiles up ON au.id = up.user_id
WHERE au.email = 'admin-email@example.com';
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„

**ç—‡çŠ¶**: ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã€ŒInvalid login credentialsã€ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› ã¨è§£æ±ºæ–¹æ³•**:

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆã¯ã€Supabase Dashboardã‹ã‚‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡
   - Dashboard â†’ Authentication â†’ Users â†’ Send password reset email

2. **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæœªç¢ºèª**
   ```sql
   -- ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’å®Œäº†
   UPDATE auth.users
   SET email_confirmed_at = now()
   WHERE email = 'your-email@example.com';
   ```

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒBANã•ã‚Œã¦ã„ã‚‹**
   ```sql
   -- BANçŠ¶æ…‹ã‚’ç¢ºèª
   SELECT 
     au.email,
     au.banned_until,
     up.is_banned
   FROM auth.users au
   LEFT JOIN public.user_profiles up ON au.id = up.user_id
   WHERE au.email = 'your-email@example.com';
   
   -- BANè§£é™¤
   UPDATE auth.users
   SET banned_until = NULL
   WHERE email = 'your-email@example.com';
   
   UPDATE public.user_profiles
   SET is_banned = false
   WHERE user_id IN (
     SELECT id FROM auth.users WHERE email = 'your-email@example.com'
   );
   ```

### å•é¡Œ2: ç®¡ç†è€…æ¨©é™ãŒè¨­å®šã•ã‚Œãªã„

**ç—‡çŠ¶**: `role`ãŒ`'admin'`ã«ãªã‚‰ãªã„

**è§£æ±ºæ–¹æ³•**:

1. **user_profilesã«ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª**
   ```sql
   SELECT 
     au.id,
     au.email,
     up.user_id,
     up.role
   FROM auth.users au
   LEFT JOIN public.user_profiles up ON au.id = up.user_id
   WHERE au.email = 'your-email@example.com';
   ```

2. **user_profilesãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ**
   ```sql
   -- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆ
   INSERT INTO public.user_profiles (
     user_id,
     display_name,
     role,
     is_banned,
     created_at,
     updated_at
   )
   SELECT 
     id,
     email,
     'user',
     false,
     created_at,
     now()
   FROM auth.users
   WHERE email = 'your-email@example.com'
   AND NOT EXISTS (
     SELECT 1 FROM public.user_profiles WHERE user_id = auth.users.id
   );
   ```

3. **user_idã‚’ç›´æ¥æŒ‡å®šã—ã¦æ›´æ–°**
   ```sql
   -- user_idã‚’ç›´æ¥æŒ‡å®šï¼ˆæœ€ã‚‚ç¢ºå®Ÿï¼‰
   UPDATE public.user_profiles
   SET role = 'admin', updated_at = now()
   WHERE user_id = 'actual-user-uuid-here';
   ```

### å•é¡Œ3: ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**ç—‡çŠ¶**: `/admin`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

**åŸå› ã¨è§£æ±ºæ–¹æ³•**:

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®roleãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**
   ```sql
   SELECT 
     au.email,
     up.role
   FROM auth.users au
   LEFT JOIN public.user_profiles up ON au.id = up.user_id
   WHERE au.email = 'your-email@example.com';
   ```

2. **ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢**
   - `Cmd + Shift + Delete`ï¼ˆMacï¼‰ã¾ãŸã¯ `Ctrl + Shift + Delete`ï¼ˆWindowsï¼‰
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èµ·å‹•

3. **ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦å†åº¦ãƒ­ã‚°ã‚¤ãƒ³**
   - ä¸€åº¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã‹ã‚‰ã€å†åº¦ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³

---

## ä¾¿åˆ©ãªã‚¯ã‚¨ãƒªé›†

### ç¾åœ¨ã®ç®¡ç†è€…æ•°ã‚’ç¢ºèª

```sql
SELECT COUNT(*) as admin_count
FROM public.user_profiles
WHERE role = 'admin';
```

### å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãã®ãƒ­ãƒ¼ãƒ«ã‚’ç¢ºèª

```sql
SELECT 
  au.id,
  au.email,
  up.display_name,
  up.role,
  up.is_banned,
  au.email_confirmed_at,
  au.created_at
FROM auth.users au
LEFT JOIN public.user_profiles up ON au.id = up.user_id
ORDER BY au.created_at DESC;
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å®Œå…¨ãªçŠ¶æ…‹ã‚’ç¢ºèª

```sql
SELECT 
  au.id,
  au.email,
  au.email_confirmed_at IS NOT NULL as email_confirmed,
  au.encrypted_password IS NOT NULL as has_password,
  au.banned_until,
  up.role,
  up.is_banned as profile_banned,
  up.display_name,
  up.created_at
FROM auth.users au
LEFT JOIN public.user_profiles up ON au.id = up.user_id
WHERE au.email = 'your-email@example.com';
```

---

## æ³¨æ„äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **ç®¡ç†è€…æ¨©é™ã¯æ…é‡ã«ä»˜ä¸ã—ã¦ãã ã•ã„**
- ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’é–²è¦§ãƒ»æ“ä½œã§ãã¾ã™
- æœ¬ç•ªç’°å¢ƒã§ã¯ã€å¿…ãšå¼·å›ºãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **æœ¬ç•ªç’°å¢ƒã§ã®åˆæœŸç®¡ç†è€…ä½œæˆ**
   - ã‚µã‚¤ãƒˆã®ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã§è‡ªåˆ†ã‚’ç™»éŒ²
   - ãã®å¾Œã€SQLã§ç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸
   - å¼·å›ºãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š

2. **ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ç®¡ç†è€…ä½œæˆ**
   - ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
   - SQLã§ç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸
   - ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã¯å‰Šé™¤ã¾ãŸã¯æ¨©é™å‰¥å¥ª

3. **ç®¡ç†è€…ã®ç®¡ç†**
   - å®šæœŸçš„ã«ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’ç¢ºèª
   - ä¸è¦ãªç®¡ç†è€…æ¨©é™ã¯å‰¥å¥ª
   - ç®¡ç†è€…ãƒ­ã‚°ã®ç›£è¦–

---

## å‚è€ƒ

- [è©³ç´°è¨­è¨ˆæ›¸ - ç®¡ç†è€…æ©Ÿèƒ½](./è©³ç´°è¨­è¨ˆæ›¸.md#33-ç®¡ç†è€…æ©Ÿèƒ½)
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†](./ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸.md)
- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥  
**æ›´æ–°æ—¥**: 2025å¹´10æœˆ27æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

